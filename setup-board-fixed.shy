#!/bin/bash

# ConfiguraciÃ³n
REPO="allanbarahona-web3/whatsapp-reminders-saas"
PROJECT_TITLE="WhatsApp Reminders SaaS (MVP)"

echo "ğŸš€ Configurando GitHub Project para: $REPO"
echo "ğŸ“‹ Proyecto: $PROJECT_TITLE"

# Verificar que estamos en el repo correcto
if ! git remote get-url origin | grep -q "$REPO"; then
    echo "âŒ Error: No estÃ¡s en el repositorio correcto"
    exit 1
fi

# FunciÃ³n para crear milestones
create_milestones() {
    echo "ğŸ“… Creando milestones..."
    
    # Sprint 1 - MVP BÃ¡sico
    gh api repos/$REPO/milestones \
        --method POST \
        --field title="Sprint 1 - MVP BÃ¡sico" \
        --field description="WhatsApp API + respuestas automÃ¡ticas bÃ¡sicas" \
        --field due_on="2025-09-03T23:59:59Z" 2>/dev/null || echo "Milestone 'Sprint 1' ya existe"
    
    # Sprint 2 - Integraciones
    gh api repos/$REPO/milestones \
        --method POST \
        --field title="Sprint 2 - Integraciones" \
        --field description="Google Sheets + webhooks + n8n" \
        --field due_on="2025-09-17T23:59:59Z" 2>/dev/null || echo "Milestone 'Sprint 2' ya existe"
    
    # Sprint 3 - SaaS Features
    gh api repos/$REPO/milestones \
        --method POST \
        --field title="Sprint 3 - SaaS Features" \
        --field description="Dashboard + pricing + deploy" \
        --field due_on="2025-10-01T23:59:59Z" 2>/dev/null || echo "Milestone 'Sprint 3' ya existe"
}

# FunciÃ³n para crear labels
create_labels() {
    echo "ğŸ·ï¸ Creando labels..."
    
    # Labels por tipo
    gh label create "ğŸš€ feature" --description "Nueva funcionalidad" --color "0075ca" 2>/dev/null || true
    gh label create "ğŸ› bug" --description "Error a corregir" --color "d73a4a" 2>/dev/null || true
    gh label create "ğŸ“š docs" --description "DocumentaciÃ³n" --color "0052cc" 2>/dev/null || true
    gh label create "ğŸ”§ setup" --description "ConfiguraciÃ³n inicial" --color "1d76db" 2>/dev/null || true
    
    # Labels por prioridad
    gh label create "ğŸ”¥ high" --description "Prioridad alta" --color "ff6b6b" 2>/dev/null || true
    gh label create "ğŸ“Š medium" --description "Prioridad media" --color "ffd93d" 2>/dev/null || true
    gh label create "ğŸ“ low" --description "Prioridad baja" --color "6bcf7f" 2>/dev/null || true
}

# FunciÃ³n para crear issues del Sprint 1
create_sprint1_issues() {
    echo "ğŸ“ Creando issues para Sprint 1..."
    
    # Issue 1
    gh issue create \
        --title "ğŸ”§ ConfiguraciÃ³n inicial del proyecto" \
        --body "**DescripciÃ³n:**
Configurar estructura bÃ¡sica del proyecto NestJS para WhatsApp SaaS

**Tareas:**
- [ ] Inicializar proyecto NestJS
- [ ] Configurar TypeScript y linting
- [ ] Setup de variables de entorno
- [ ] Estructura de carpetas
- [ ] README bÃ¡sico

**Criterios de aceptaciÃ³n:**
- Proyecto corre con \`npm start\`
- Variables de entorno configuradas
- Estructura clara de carpetas" \
        --label "ğŸ”§ setup,ğŸ”¥ high" \
        --milestone "Sprint 1 - MVP BÃ¡sico" || true
    
    # Issue 2
    gh issue create \
        --title "ğŸš€ IntegraciÃ³n WhatsApp Business API bÃ¡sica" \
        --body "**DescripciÃ³n:**
Implementar conexiÃ³n bÃ¡sica con WhatsApp Business API

**Tareas:**
- [ ] Configurar webhook para recibir mensajes
- [ ] Implementar envÃ­o de mensajes bÃ¡sico
- [ ] ValidaciÃ³n de nÃºmeros de telÃ©fono
- [ ] Manejo de errores bÃ¡sico

**Criterios de aceptaciÃ³n:**
- Recibe mensajes de WhatsApp
- Puede enviar respuestas automÃ¡ticas
- Logs de errores funcionando" \
        --label "ğŸš€ feature,ğŸ”¥ high" \
        --milestone "Sprint 1 - MVP BÃ¡sico" || true
    
    # Issue 3
    gh issue create \
        --title "ğŸš€ Sistema de respuestas automÃ¡ticas" \
        --body "**DescripciÃ³n:**
Crear sistema para responder automÃ¡ticamente a mensajes

**Tareas:**
- [ ] Parser de mensajes entrantes
- [ ] Motor de respuestas automÃ¡ticas
- [ ] ConfiguraciÃ³n de respuestas default
- [ ] Testing bÃ¡sico

**Criterios de aceptaciÃ³n:**
- Responde automÃ¡ticamente a palabras clave
- Respuesta default para mensajes no reconocidos
- Testing unitario bÃ¡sico" \
        --label "ğŸš€ feature,ğŸ“Š medium" \
        --milestone "Sprint 1 - MVP BÃ¡sico" || true
}

# FunciÃ³n para crear issues del Sprint 2
create_sprint2_issues() {
    echo "ğŸ“ Creando issues para Sprint 2..."
    
    # Issue 4
    gh issue create \
        --title "ğŸš€ IntegraciÃ³n con Google Sheets" \
        --body "**DescripciÃ³n:**
Conectar WhatsApp con Google Sheets para logging y configuraciÃ³n

**Tareas:**
- [ ] Configurar Google Sheets API
- [ ] Endpoint para escribir mensajes en sheet
- [ ] Leer configuraciones desde sheet
- [ ] Manejo de errores de API

**Criterios de aceptaciÃ³n:**
- Mensajes se guardan en Google Sheets
- Configuraciones se leen desde sheet
- Manejo de rate limits" \
        --label "ğŸš€ feature,ğŸ”¥ high" \
        --milestone "Sprint 2 - Integraciones" || true
    
    # Issue 5
    gh issue create \
        --title "ğŸš€ Sistema de webhooks configurables" \
        --body "**DescripciÃ³n:**
Implementar webhooks para integraciones externas

**Tareas:**
- [ ] Endpoint para recibir webhooks
- [ ] Sistema de envÃ­o de webhooks
- [ ] ConfiguraciÃ³n de URLs de destino
- [ ] Retry logic para fallos

**Criterios de aceptaciÃ³n:**
- Recibe webhooks externos
- EnvÃ­a data a URLs configuradas
- Retry automÃ¡tico en fallos" \
        --label "ğŸš€ feature,ğŸ“Š medium" \
        --milestone "Sprint 2 - Integraciones" || true
}

# FunciÃ³n para crear issues del Sprint 3
create_sprint3_issues() {
    echo "ğŸ“ Creando issues para Sprint 3..."
    
    # Issue 6
    gh issue create \
        --title "ğŸš€ Dashboard bÃ¡sico para configuraciÃ³n" \
        --body "**DescripciÃ³n:**
Crear interfaz web para configurar el bot de WhatsApp

**Tareas:**
- [ ] Frontend bÃ¡sico (React/HTML)
- [ ] ConfiguraciÃ³n de respuestas automÃ¡ticas
- [ ] VisualizaciÃ³n de mensajes recibidos
- [ ] ConfiguraciÃ³n de integraciones

**Criterios de aceptaciÃ³n:**
- Interface web funcional
- CRUD de respuestas automÃ¡ticas
- Dashboard responsive" \
        --label "ğŸš€ feature,ğŸ“Š medium" \
        --milestone "Sprint 3 - SaaS Features" || true
    
    # Issue 7
    gh issue create \
        --title "ğŸš€ Sistema de pricing y planes" \
        --body "**DescripciÃ³n:**
Implementar diferentes planes de pricing para el SaaS

**Tareas:**
- [ ] Modelos de planes (Free, Pro, Enterprise)
- [ ] LÃ­mites por plan (mensajes/mes)
- [ ] Sistema de billing bÃ¡sico
- [ ] Upgrade/downgrade de planes

**Criterios de aceptaciÃ³n:**
- 3 planes claramente definidos
- LÃ­mites se respetan automÃ¡ticamente
- Flujo de upgrade funcional" \
        --label "ğŸš€ feature,ğŸ“ low" \
        --milestone "Sprint 3 - SaaS Features" || true
}

# Ejecutar todo
echo "ğŸ¯ Iniciando setup del proyecto..."
create_milestones
create_labels
create_sprint1_issues
create_sprint2_issues
create_sprint3_issues

echo ""
echo "âœ… Â¡Setup completado!"
echo "ğŸ‘‰ Ve a: https://github.com/$REPO/issues"
echo "ğŸ“‹ Proyecto: https://github.com/$REPO/projects"
echo ""
echo "ğŸš€ Â¡Ya puedes empezar a trabajar en tu primer sprint!"
